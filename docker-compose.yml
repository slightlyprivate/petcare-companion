services:
  # Production-oriented stack (images expected to be built/published)
  # Note: DB/Redis are external in production; inject hosts via env.

  app:
    container_name: petcare_app
    image: ghcr.io/yourorg/petcare-app:prod
    env_file: .env
    read_only: true
    tmpfs:
      - /tmp
    healthcheck:
      test: ["CMD-SHELL", "php -v >/dev/null 2>&1 || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3

  web:
    container_name: petcare_web
    image: ghcr.io/yourorg/petcare-web:prod
    depends_on:
      - app
    ports:
      - "8080:80"
    read_only: true
    tmpfs:
      - /var/cache/nginx
      - /var/run
    healthcheck:
      test: ["CMD-SHELL", "wget -qO- http://localhost/health || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3

  worker:
    container_name: petcare_worker
    image: ghcr.io/yourorg/petcare-app:prod
    command: php artisan queue:work --sleep=3 --tries=3 --memory=256
    env_file: .env
    read_only: true
    tmpfs:
      - /tmp

  frontend:
    container_name: petcare_frontend
    image: ghcr.io/yourorg/petcare-frontend:prod
    environment:
      SERVER_PORT: 3000
      BACKEND_URL: http://web
    depends_on:
      - web
    ports:
      - "5174:3000"
    read_only: true
    healthcheck:
      test: ["CMD-SHELL", "wget -qO- http://localhost:3000/health >/dev/null 2>&1 || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3

