services:
  app:
    container_name: petcare_app_staging
    image: ghcr.io/slightlyprivate/petcare-companion-app:develop
    env_file:
      - .env.staging
    healthcheck:
      test: ['CMD', 'php', '-v']
      interval: 20s
      timeout: 5s
      retries: 5
    restart: unless-stopped
    networks:
      - default
      - shared-db
      - shared-cache
    volumes:
      - storage:/var/www/html/storage/app/public

  web:
    container_name: petcare_web_staging
    image: ghcr.io/slightlyprivate/petcare-companion-web:develop
    env_file:
      - .env.staging
    depends_on:
      app:
        condition: service_healthy
    ports:
      - '9080:80'
    restart: unless-stopped
    networks:
      - default
    volumes:
      - storage:/var/www/html/storage/app/public:ro

  ui:
    container_name: petcare_ui_staging
    image: ghcr.io/slightlyprivate/petcare-companion-ui:develop
    depends_on:
      web:
        condition: service_healthy
    ports:
      - '9081:80'
    restart: unless-stopped
    networks:
      - default

  mailhog:
    container_name: petcare_mailhog_staging
    image: mailhog/mailhog:latest
    ports:
      - '127.0.0.1:8026:8025'
      - '127.0.0.1:1026:1025'
    restart: unless-stopped
    networks:
      - default

volumes:
  storage:

networks:
  shared-db:
    external: true
  shared-cache:
    external: true
